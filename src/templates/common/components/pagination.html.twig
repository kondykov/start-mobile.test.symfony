{% if pagination.total > pagination.pageSize %}
    {% set totalPages = (pagination.total / pagination.pageSize)|round(0, 'ceil') %}
    {% set currentPage = pagination.page %}
    {% set maxVisiblePages = 5 %}

    {% set currentRoute = app.request.attributes.get('_route') %}
    {% set currentParams = app.request.attributes.get('_route_params')|merge(app.request.query.all) %}

    <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center">
            {# Previous page button #}
            <li class="page-item {% if currentPage == 1 %}disabled{% endif %}">
                <a class="page-link"
                   href="{% if currentPage > 1 %}{{ path(currentRoute, currentParams|merge({'page': currentPage - 1})) }}{% else %}#{% endif %}"
                   aria-label="Previous">
                    <span aria-hidden="true">&laquo;</span>
                </a>
            </li>

            {# First page #}
            {% if currentPage > (maxVisiblePages // 2 + 1) %}
                <li class="page-item">
                    <a class="page-link" href="{{ path(currentRoute, currentParams|merge({'page': 1})) }}">
                        1
                    </a>
                </li>
                {% if currentPage > (maxVisiblePages // 2 + 2) %}
                    <li class="page-item disabled">
                        <span class="page-link">...</span>
                    </li>
                {% endif %}
            {% endif %}

            {# Page numbers #}
            {% for page in range(max(1, currentPage - (maxVisiblePages // 2)), min(totalPages, currentPage + (maxVisiblePages // 2))) %}
                <li class="page-item {% if page == currentPage %}active{% endif %}">
                    <a class="page-link"
                       href="{{ path(currentRoute, currentParams|merge({'page': page})) }}">
                        {{ page }}
                    </a>
                </li>
            {% endfor %}

            {# Last page #}
            {% if currentPage < (totalPages - (maxVisiblePages // 2)) %}
                {% if currentPage < (totalPages - (maxVisiblePages // 2 + 1)) %}
                    <li class="page-item disabled">
                        <span class="page-link">...</span>
                    </li>
                {% endif %}
                <li class="page-item">
                    <a class="page-link" href="{{ path(currentRoute, currentParams|merge({'page': totalPages})) }}">
                        {{ totalPages }}
                    </a>
                </li>
            {% endif %}

            {# Next page button #}
            <li class="page-item {% if currentPage == totalPages %}disabled{% endif %}">
                <a class="page-link"
                   href="{% if currentPage < totalPages %}{{ path(currentRoute, currentParams|merge({'page': currentPage + 1})) }}{% else %}#{% endif %}"
                   aria-label="Next">
                    <span aria-hidden="true">&raquo;</span>
                </a>
            </li>
        </ul>
    </nav>

    {# Pagination info #}
    <div class="text-center text-muted mt-2">
        <small>
            Показано {{ ((currentPage - 1) * pagination.pageSize) + 1 }} -
            {{ min(currentPage * pagination.pageSize, pagination.total) }}
            из {{ pagination.total }} записей
        </small>
    </div>
{% endif %}
